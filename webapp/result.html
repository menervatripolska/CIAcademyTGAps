<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>–í–µ—Ä–¥–∏–∫—Ç –ê–∫–∞–¥–µ–º–∏–∏ ‚Äî Crypto Intelligence Academy</title>
  <link rel="stylesheet" href="css/kryptan.css">
  <style>
    .result-block { display: none; }
    .result-block.visible { display: block; }

    /* Verdict glow animations */
    @keyframes verdictReveal {
      0%   { opacity: 0; transform: translateY(30px) scale(0.95); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }
    .verdict-card { animation: verdictReveal 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards; }

    .pattern-num-huge {
      font-family: var(--font-title);
      font-size: clamp(4rem, 15vw, 7rem);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1;
      display: block;
      margin-bottom: 8px;
    }

    /* per pattern glow */
    .p1 .pattern-num-huge { color:#ff5252; text-shadow: 0 0 40px rgba(255,82,82,0.8), 0 0 100px rgba(255,82,82,0.3); }
    .p2 .pattern-num-huge { color:#ff9800; text-shadow: 0 0 40px rgba(255,152,0,0.8), 0 0 100px rgba(255,152,0,0.3); }
    .p3 .pattern-num-huge { color:var(--neon-cyan); text-shadow: 0 0 40px rgba(0,229,255,0.8), 0 0 100px rgba(0,229,255,0.3); }
    .p4 .pattern-num-huge { color:var(--neon-green); text-shadow: 0 0 40px rgba(0,230,118,0.9), 0 0 100px rgba(0,230,118,0.4); }
    .p5 .pattern-num-huge { color:var(--neon-violet); text-shadow: 0 0 40px rgba(191,95,255,0.9), 0 0 120px rgba(155,48,255,0.5); }

    .pattern-codename {
      font-family: var(--font-title);
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      opacity: 0.7;
      margin-bottom: 24px;
    }

    .stamp-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 20px;
      border-radius: 6px;
      font-family: var(--font-title);
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      border: 2px solid;
      margin-bottom: 20px;
      transform: rotate(-1.5deg);
    }
    .p1 .stamp-badge,.p2 .stamp-badge { color:#ff5252; border-color:#ff5252; background:rgba(255,82,82,0.06); }
    .p3 .stamp-badge { color:var(--neon-cyan); border-color:var(--neon-cyan); background:rgba(0,229,255,0.05); }
    .p4 .stamp-badge { color:var(--neon-green); border-color:var(--neon-green); background:rgba(0,230,118,0.06); }
    .p5 .stamp-badge { color:var(--neon-violet); border-color:var(--neon-violet); background:rgba(191,95,255,0.08); }

    .test-summary-row {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-subtle);
    }
    .test-summary-row:last-child { border-bottom: none; }
    .test-summary-icon {
      font-size: 1.2rem;
      min-width: 28px;
    }
    .test-summary-title {
      font-family: var(--font-body);
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--text-secondary);
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-bottom: 2px;
    }
    .test-summary-val {
      font-family: var(--font-body);
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-primary);
    }
  </style>
</head>
<body>
<div class="page-wrap">

  <!-- Loading state -->
  <div id="loadingState" style="padding:60px 0;text-align:center;">
    <div class="spinner"></div>
    <p style="font-family:var(--font-body);color:var(--text-muted);margin-top:16px;">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...</p>
  </div>

  <!-- Incomplete warning -->
  <div id="incompleteState" style="display:none;padding:40px 0;">
    <div class="ka-card" style="text-align:center;">
      <div style="font-size:3rem;margin-bottom:16px;">‚ö†Ô∏è</div>
      <h2 style="font-family:var(--font-title);font-size:1.2rem;color:var(--neon-gold);margin-bottom:12px;">–ù–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã</h2>
      <p style="font-family:var(--font-body);color:var(--text-secondary);margin-bottom:20px;">–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Ä–¥–∏–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–π—Ç–∏ –≤—Å–µ 5 —Ç–µ—Å—Ç–æ–≤.</p>
      <button class="btn btn-primary" onclick="window.location.href='index.html'">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ—Å—Ç–∞–º</button>
    </div>
  </div>

  <!-- Results -->
  <div id="mainResults" style="display:none;">

    <div class="result-header">
      <div class="ka-logo" style="justify-content:center;margin-bottom:16px;">
        <div class="ka-logo-icon">K</div>
        <span class="ka-logo-text">Crypto Intelligence Academy</span>
      </div>
      <h1 class="result-title">–¢–≤–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h1>
      <p class="result-subtitle">–û—Ç–±–æ—Ä–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</p>
    </div>

    <!-- Individual test results -->
    <div class="ka-card" id="resultsCard">
      <div class="question-num">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</div>
      <div id="testSummaries"></div>
    </div>

    <!-- VERDICT SECTION -->
    <div class="verdict-section">
      <div class="verdict-label">
        ‚¨° –í–µ—Ä–¥–∏–∫—Ç –ê–∫–∞–¥–µ–º–∏–∏ ‚¨°
      </div>

      <div class="verdict-card" id="verdictCard">
        <div style="text-align:center;">
          <div class="stamp-badge" id="verdictBadge"></div>
          <span class="pattern-num-huge" id="verdictNum"></span>
          <div class="pattern-codename" id="verdictName"></div>
        </div>

        <div class="chain-divider" style="margin:20px 0;"><span class="chain-icon">‚óá</span></div>

        <div class="verdict-text" id="verdictText"></div>
      </div>
    </div>

    <!-- Submit button -->
    <div style="margin-top:28px;">
      <button class="btn btn-primary btn-full" id="submitBtn" onclick="submitResults()">
        üì§ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ—Ç–±–æ—Ä ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      </button>
      <p style="font-family:var(--font-text);font-size:0.8rem;color:var(--text-muted);text-align:center;margin-top:10px;">
        –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –∫—É—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∏—Ç —Ç–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
      </p>
    </div>

  </div>

</div>

<script src="js/core.js"></script>
<script>
const PATTERNS = {
  1: {
    name: '–ê–†–•–ò–í',
    badge: 'üî¥ –û–¢–ö–ê–ó',
    verdict: `–†—ã–Ω–æ–∫ –≤–∞—Å —É–Ω–∏—á—Ç–æ–∂–∏—Ç. –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: —Å–æ—á–µ—Ç–∞–Ω–∏–µ –Ω–∏–∑–∫–æ–π –∂–∏–∑–Ω–µ—Å—Ç–æ–π–∫–æ—Å—Ç–∏, —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç–∏ –∫ –∏–º–ø—É–ª—å—Å–∏–≤–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º –∏ –∏–Ω—Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∫ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—ë—Ç —Å–º–µ—Ä—Ç–µ–ª—å–Ω–æ –æ–ø–∞—Å–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ã–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏.\n\n–í–æ–∑–º–æ–∂–Ω—ã —Å–µ—Ä—å—ë–∑–Ω—ã–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏. –ö–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Ç—Ä–µ–π–¥–∏–Ω–≥–æ–º. –í–∞—à –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—É—Ç—å ‚Äî —Å–≤–µ—Ä—Ö–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ —Å–±–µ—Ä–µ–∂–µ–Ω–∏—è (–¥–µ–ø–æ–∑–∏—Ç—ã, –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–ª–∏–≥–∞—Ü–∏–∏).\n\n–ú—ã –≤—ã–Ω—É–∂–¥–µ–Ω—ã –æ—Ç–∫–∞–∑–∞—Ç—å –≤–∞–º –≤ –¥–æ—Å—Ç—É–ø–µ –∫ –∞–∫—Ç–∏–≤–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –ê–∫–∞–¥–µ–º–∏–∏.`,
  },
  2: {
    name: '–ê–ù–ê–õ–ò–¢–ò–ö',
    badge: 'üü† –û–ì–†–ê–ù–ò–ß–ï–ù–û',
    verdict: `–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å ‚Äî —Å—Ç—Ä–æ–≥–∏–π —Ä–∞—Å—á—ë—Ç. –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –≤—ã—Å–æ–∫, –Ω–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–µ–π–¥–∏–Ω–≥ –∏ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —Å–¥–µ–ª–∫–∏ ‚Äî –æ–Ω–∏ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—é –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–º –æ—à–∏–±–∫–∞–º –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º.\n\n–í–∞—à –ø—É—Ç—å ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ì—Ä—ç–º–∞, –ë–∞—Ñ—Ñ–µ—Ç–∞, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º –±–µ–∑ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–∞—á–µ–ª–µ–π.\n\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—É—á–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ¬´–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –∏–Ω–≤–µ—Å—Ç–æ—Ä¬ª. –°–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Äî –ø–æ–¥ –∑–∞–ø—Ä–µ—Ç–æ–º.`,
  },
  3: {
    name: '–ù–ê–í–ò–ì–ê–¢–û–†',
    badge: 'üîµ –î–û–ü–£–°–ö',
    verdict: `–í—ã –≥–æ—Ç–æ–≤—ã –∫ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—é –≤ –∫—Ä–∏–ø—Ç–æ-–∏–Ω–¥—É—Å—Ç—Ä–∏—é, –Ω–æ –≤–∞–º –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω—ã –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Å–ø–µ–∫—É–ª—è—Ü–∏–∏. –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å –¥–æ–ø—É—Å–∫–∞–µ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —Å—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ–≥–æ —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ –ø—Ä–∏ —Å—Ç—Ä–æ–≥–æ–º —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã.\n\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ñ–æ–∫—É—Å: –Ω–∞–¥—ë–∂–Ω—ã–µ –∞–∫—Ç–∏–≤—ã (BTC, ETH, —Å—Ç–µ–π–∫–∏–Ω–≥, –¥–µ–ø–æ–∑–∏—Ç—ã –≤ DeFi), –≥–æ—Ä–∏–∑–æ–Ω—Ç –æ—Ç 3 –º–µ—Å—è—Ü–µ–≤. –í—ã—Å–æ–∫–æ–ø–ª–µ—á–µ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –º–µ–º–∫–æ–∏–Ω—ã ‚Äî –≤–Ω–µ –∑–æ–Ω—ã –¥–æ–ø—É—Å–∫–∞.\n\n–ê–∫–∞–¥–µ–º–∏—è –≥–æ—Ç–æ–≤–∞ –ø—Ä–∏–Ω—è—Ç—å –≤–∞—Å –Ω–∞ –±–∞–∑–æ–≤—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Å —É—Å–∏–ª–µ–Ω–Ω—ã–º –±–ª–æ–∫–æ–º –ø–æ —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É.`,
  },
  4: {
    name: '–û–ü–ï–†–ê–¢–û–†',
    badge: 'üü¢ –ó–ï–õ–Å–ù–´–ô –°–í–ï–¢',
    verdict: `–°–∏—Å—Ç–µ–º–∞ –¥–∞—ë—Ç –ø–æ–ª–Ω—ã–π –¥–æ–ø—É—Å–∫. –í–∞—à –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏–º–º—É–Ω–∏—Ç–µ—Ç, –≤—ã—Å–æ–∫–∞—è –∂–∏–∑–Ω–µ—Å—Ç–æ–π–∫–æ—Å—Ç—å –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞—é—Ç —É—Å—Ç–æ–π—á–∏–≤—É—é –±–∞–∑—É –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏.\n\n–î–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –∏ –∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–π–¥–∏–Ω–≥ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —Å—Ç—Ä–æ–≥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞. –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –≤—ã–¥–µ—Ä–∂–∏—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∫—Ä–∏–ø—Ç–æ—Ä—ã–Ω–∫–∞ –±–µ–∑ —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.\n\n–ê–∫–∞–¥–µ–º–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –ø–æ–ª–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É —Å –±–ª–æ–∫–æ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏—è–º–∏.`,
  },
  5: {
    name: '–≠–õ–ò–¢–ê',
    badge: '‚ö° –≠–õ–ò–¢–ù–´–ô –ü–†–û–§–ò–õ–¨',
    verdict: `–†–µ–¥–∫–∏–π —Å–ª—É—á–∞–π. –≠–ª–∏—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å. –ß–µ–ª–æ–≤–µ–∫, –±–µ—Ä—É—â–∏–π –∞–±—Å–æ–ª—é—Ç–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ—é –∂–∏–∑–Ω—å –∏ –∫–∞–ø–∏—Ç–∞–ª ‚Äî –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–∏—Ö –º—ã –∏—â–µ–º.\n\n–ü–æ–∫–∞–∑–∞–Ω —Ç—Ä–µ–π–¥–∏–Ω–≥ –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ: –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ, —Å—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ –∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –≤–∫–ª—é—á–∞—è —Å–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ –∏ –≤—ã—Å–æ–∫–æ–¥–æ—Ö–æ–¥–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (—Ñ—å—é—á–µ—Ä—Å—ã, –æ–ø—Ü–∏–æ–Ω—ã, DeFi-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã).\n\n–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤ –º–∞—Å—Ç–µ—Ä-–ø—Ä–æ–≥—Ä–∞–º–º—É –ê–∫–∞–¥–µ–º–∏–∏. –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å ‚Äî –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–æ–π –º—ã –æ–±—É—á–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.`,
  },
};

function calcPattern(p) {
  // Scoring based on all 5 tests
  let score = 0;

  // 1. Gambling ‚Äî risk level
  if (p.gambling) {
    const gs = p.gambling.score || 0;
    if (gs === 0) score += 2;
    else if (gs <= 3) score += 1;
    else if (gs >= 6) score -= 2;
    else score -= 1;
  }

  // 2. Hardiness ‚Äî total
  if (p.hardiness) {
    const ht = p.hardiness.total || 0;
    if (ht >= 99) score += 2;
    else if (ht >= 80) score += 1;
    else if (ht <= 62) score -= 2;
    else score -= 1;
  }

  // 3. Tolerance ‚Äî tn level
  if (p.tolerance) {
    const tn = p.tolerance.tn || 0;
    if (tn > 40) score += 2;
    else if (tn > 30) score += 1;
    else score -= 1;
  }

  // 4. Holland ‚Äî entrepreneurial E is positive for trading
  if (p.holland) {
    const top = p.holland.topType;
    if (top === 'E') score += 2;
    else if (top === 'I' || top === 'C') score += 1;
    else if (top === 'S') score -= 1;
  }

  // 5. Proforientation ‚Äî biz/risk = positive
  if (p.proforientation) {
    const tops = p.proforientation.topSpheres || [];
    if (tops.includes('biz') || tops.includes('risk')) score += 1;
    if (tops.includes('logic')) score += 1;
  }

  // Map score to pattern 1-5
  if (score <= -2) return 1;
  if (score <= 0)  return 2;
  if (score <= 2)  return 3;
  if (score <= 4)  return 4;
  return 5;
}

function renderTestSummaries(p) {
  const summaries = [
    {
      icon: 'üéØ',
      title: '–¢–µ—Å—Ç –ì–æ–ª–ª–∞–Ω–¥–∞',
      val: p.holland ? `${p.holland.topName} (${p.holland.sortedTop3 || ''})` : '‚Äî',
    },
    {
      icon: 'üé≤',
      title: '–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –∞–∑–∞—Ä—Ç—É',
      val: p.gambling ? `${p.gambling.level} (${p.gambling.score}/8 –±–∞–ª–ª–æ–≤)` : '‚Äî',
    },
    {
      icon: 'üõ°Ô∏è',
      title: '–ñ–∏–∑–Ω–µ—Å—Ç–æ–π–∫–æ—Å—Ç—å',
      val: p.hardiness ? `–û–±—â–∏–π –∏–Ω–¥–µ–∫—Å: ${p.hardiness.total} | –í:${p.hardiness.commitment} –ö:${p.hardiness.control} –†:${p.hardiness.challenge}` : '‚Äî',
    },
    {
      icon: 'üî≠',
      title: '–ü—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
      val: p.proforientation ? (p.proforientation.topSpheres?.length ? `–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: ${p.proforientation.topSpheres.join(', ')}` : '–ù–µ—Ç —è–≤–Ω—ã—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤') : '‚Äî',
    },
    {
      icon: '‚öñÔ∏è',
      title: '–¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏',
      val: p.tolerance ? `–¢–ù:${p.tolerance.tn} –ò–¢–ù:${p.tolerance.itn} –ú–ò–¢–ù:${p.tolerance.mitn}` : '‚Äî',
    },
  ];

  return summaries.map(s => `
    <div class="test-summary-row">
      <div class="test-summary-icon">${s.icon}</div>
      <div>
        <div class="test-summary-title">${s.title}</div>
        <div class="test-summary-val">${s.val}</div>
      </div>
    </div>`).join('');
}

// ‚îÄ‚îÄ –ö–æ–Ω—Ñ–∏–≥ –±–æ—Ç–∞ ‚Äî –≤—Å—Ç–∞–≤—å —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è ‚îÄ‚îÄ
var BOT_TOKEN  = '8753082286:AAH2IAfGsQ_X_k4oxf6Tpj2jQeWjHT6ZVJc';
var ADMIN_CHAT = '5376892021';  // —Ç–≤–æ–π Telegram ID ‚Äî –∫—É–¥–∞ –ø—Ä–∏–¥—É—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

var PATTERN_LABELS = {
  1: 'üî¥ –ü–ê–¢–¢–ï–†–ù 1 ‚Äî –ê–†–•–ò–í (–û—Ç–∫–∞–∑)',
  2: 'üü† –ü–ê–¢–¢–ï–†–ù 2 ‚Äî –ê–ù–ê–õ–ò–¢–ò–ö (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø)',
  3: 'üîµ –ü–ê–¢–¢–ï–†–ù 3 ‚Äî –ù–ê–í–ò–ì–ê–¢–û–† (–ë–∞–∑–æ–≤—ã–π –¥–æ–ø—É—Å–∫)',
  4: 'üü¢ –ü–ê–¢–¢–ï–†–ù 4 ‚Äî –û–ü–ï–†–ê–¢–û–† (–ó–µ–ª—ë–Ω—ã–π —Å–≤–µ—Ç)',
  5: '‚ö° –ü–ê–¢–¢–ï–†–ù 5 ‚Äî –≠–õ–ò–¢–ê (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç)',
};

async function submitResults() {
  var p = Progress.get();
  var btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';

  var patternNum = calcPattern(p);

  // –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ Telegram WebApp (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  var tgUser = null;
  if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe) {
    tgUser = window.Telegram.WebApp.initDataUnsafe.user || null;
  }

  var userName = tgUser
    ? ((tgUser.first_name || '') + ' ' + (tgUser.last_name || '')).trim() + (tgUser.username ? ' (@' + tgUser.username + ')' : '')
    : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç';

  var userId = tgUser ? tgUser.id : '‚Äî';

  // –§–æ—Ä–º–∏—Ä—É–µ–º —á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —á–∞—Ç–∞
  var patternLabel = PATTERN_LABELS[patternNum] || ('–ü–∞—Ç—Ç–µ—Ä–Ω ' + patternNum);
  var hollandType  = (p.holland && p.holland.topType)    || '‚Äî';
  var hollandTop3  = (p.holland && p.holland.sortedTop3) || '‚Äî';
  var gambScore    = (p.gambling  && p.gambling.score  != null) ? p.gambling.score  : '?';
  var gambLevel    = (p.gambling  && p.gambling.level)   || '‚Äî';
  var hardTotal    = (p.hardiness && p.hardiness.total   != null) ? p.hardiness.total   : '?';
  var hardComm     = (p.hardiness && p.hardiness.commitment != null) ? p.hardiness.commitment : '?';
  var hardCtrl     = (p.hardiness && p.hardiness.control    != null) ? p.hardiness.control    : '?';
  var hardChal     = (p.hardiness && p.hardiness.challenge  != null) ? p.hardiness.challenge  : '?';
  var tn           = (p.tolerance && p.tolerance.tn   != null) ? p.tolerance.tn   : '?';
  var itn          = (p.tolerance && p.tolerance.itn  != null) ? p.tolerance.itn  : '?';
  var mitn         = (p.tolerance && p.tolerance.mitn != null) ? p.tolerance.mitn : '?';
  var profTop      = (p.proforientation && p.proforientation.topSpheres && p.proforientation.topSpheres.length)
    ? p.proforientation.topSpheres.join(', ')
    : '‚Äî';

  var text = [
    'üÜï –ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê ‚Äî CI ACADEMY',
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    'üë§ ' + userName,
    'üÜî ID: ' + userId,
    '',
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    patternLabel,
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    '',
    'üéØ –ì–æ–ª–ª–∞–Ω–¥: ' + hollandType + ' [' + hollandTop3 + ']',
    'üé≤ –ê–∑–∞—Ä—Ç: ' + gambLevel + ' (' + gambScore + '/8)',
    'üõ°Ô∏è –ñ–∏–∑–Ω–µ—Å—Ç–æ–π–∫–æ—Å—Ç—å: ' + hardTotal + '  (–í:' + hardComm + ' –ö:' + hardCtrl + ' –†:' + hardChal + ')',
    'üî≠ –ü—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç.: ' + profTop,
    '‚öñÔ∏è –¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å: –¢–ù:' + tn + '  –ò–¢–ù:' + itn + '  –ú–ò–¢–ù:' + mitn,
  ].join('\n');

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Telegram Bot API
  var apiUrl = 'https://api.telegram.org/bot' + BOT_TOKEN + '/sendMessage';

  try {
    var resp = await fetch(apiUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: ADMIN_CHAT,
        text: text,
        parse_mode: 'HTML',
      }),
    });

    var result = await resp.json();

    if (result.ok) {
      btn.textContent = '‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!';
      btn.style.background = 'linear-gradient(135deg, var(--neon-green), #00a152)';
      // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(function() {
        if (window.Telegram && window.Telegram.WebApp) {
          window.Telegram.WebApp.close();
        }
      }, 2000);
    } else {
      throw new Error(result.description || 'API error');
    }

  } catch(e) {
    console.error('Send error:', e);
    btn.textContent = '‚ö†Ô∏è –û—à–∏–±–∫–∞ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑';
    btn.disabled = false;
  }
}

// Init
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    const p = Progress.get();
    document.getElementById('loadingState').style.display = 'none';

    if (!Progress.allComplete()) {
      document.getElementById('incompleteState').style.display = 'block';
      return;
    }

    document.getElementById('mainResults').style.display = 'block';

    // Render summaries
    document.getElementById('testSummaries').innerHTML = renderTestSummaries(p);

    // Calculate and render verdict
    const patternNum = calcPattern(p);
    const pattern = PATTERNS[patternNum];

    const card = document.getElementById('verdictCard');
    card.classList.add(`p${patternNum}`);

    document.getElementById('verdictNum').textContent = `–ü–ê–¢–¢–ï–†–ù ${patternNum}`;
    document.getElementById('verdictName').textContent = pattern.name;
    document.getElementById('verdictBadge').textContent = pattern.badge;
    document.getElementById('verdictText').innerHTML = pattern.verdict.replace(/\n\n/g, '</p><p style="margin-top:12px;">');
    document.getElementById('verdictText').innerHTML = '<p>' + document.getElementById('verdictText').innerHTML + '</p>';

  }, 800);
});
</script>
</body>
</html>
